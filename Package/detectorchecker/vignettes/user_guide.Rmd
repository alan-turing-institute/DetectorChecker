
title: "DetectorChecker Usage"
# author: "Vignette Author"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Vignette Title}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

# DetectorChecker

DetectorChecker package ...

## Loading and visualising data

### To check available layouts:

```
detectorchecker::available_layouts
```

It will output the list of implemented layouts, for example:

```
"Excalibur" "PerkinElmerFull" "Pilatus" 
```

### To create layout object

```
layout <- detectorchecker::create_module("Pilatus")
```

### To visualise layout object

```
detectorchecker::plot_layout(layout, "layout.pdf")
```

![Pilatus layout](Pilatus_layout.jpg)

### Layout analysis

```
detectorchecker::plot_pixel_ctr_eucl(layout)
```

![Distance from the centre](pixel_ctr_eucl.jpg)

```
detectorchecker::plot_pixel_ctr_linf(layout)
```

![Parallel maxima from the centre](pixel_ctr_linf.jpg)

```
detectorchecker::plot_pixel_dist_corner(layout)
```

![Distance from corners](pixel_dist_corner.jpg)

```
detectorchecker::plot_pixel_dist_edge_col(layout)
```
![Distance from edges by column](pixel_dist_edge_col.jpg)

```
detectorchecker::plot_pixel_dist_edge_row(layout)
```
![Distance from edges by row](pixel_dist_edge_row.jpg)

```
detectorchecker::plot_pixel_dist_edge(layout)
```
![Distance from edges](pixel_dist_edge.jpg)

### To upload pixel file

#### TIFF format

```
# Choosing layout
layout <- detectorchecker::create_module("Pilatus")

# Loading the pixel matrix
dead_path <- "/Users/tlazauskas/git/Turing/DetectorChecker/Package/detectorchecker/tests/testthat/dead_pix/Pilatus/badpixel_mask.tif"
pix_matrix <- detectorchecker::load_pix_matrix(layout = layout, file_path = dead_path)

# Retreiving dead pixels
pix_dead <- detectorchecker::dead_pix_coords(pix_matrix)

# Plotting
detectorchecker::plot_layout_damaged(layout = layout, pix_dead = pix_dead,
                      file_path = "layout_damaged.jpeg")
                      
```

![Pilatus damaged](Pilatus_damaged.jpeg)

#### XML format

```
# Choosing layout
layout <- create_module("PerkinElmerFull")

# getting the dead (damaged) pixel data
dead_path <- "/Users/tlazauskas/git/Turing/DetectorChecker/Package/detectorchecker/tests/testthat/dead_pix/PerkinElmer/BadPixelMap_0.bpm/BadPixelMap.bpm.xml"

pix_matrix <- load_pix_matrix(layout = layout, file_path = dead_path)

pix_dead <- dead_pix_coords(pix_matrix)

# Plotting
detectorchecker::plot_layout_damaged(layout = layout, pix_dead = pix_dead,
                      file_path = "layout_damaged.pdf")
```

![PerkinElmerFull damaged](PerkinElmerFull_damaged.jpeg)

#### HDF

```
# Choosing layout
layout <- detectorchecker::create_module("Excalibur")

# Loading the pixel matrix
dead_path <- c("/Users/tlazauskas/git/Turing/DetectorChecker/Package/detectorchecker/tests/testthat/dead_pix/Excalibur/pixelmask.fem1.hdf", 
               "/Users/tlazauskas/git/Turing/DetectorChecker/Package/detectorchecker/tests/testthat/dead_pix/Excalibur/pixelmask.fem2.hdf",
               "/Users/tlazauskas/git/Turing/DetectorChecker/Package/detectorchecker/tests/testthat/dead_pix/Excalibur/pixelmask.fem3.hdf",
               "/Users/tlazauskas/git/Turing/DetectorChecker/Package/detectorchecker/tests/testthat/dead_pix/Excalibur/pixelmask.fem4.hdf",
               "/Users/tlazauskas/git/Turing/DetectorChecker/Package/detectorchecker/tests/testthat/dead_pix/Excalibur/pixelmask.fem5.hdf",
               "/Users/tlazauskas/git/Turing/DetectorChecker/Package/detectorchecker/tests/testthat/dead_pix/Excalibur/pixelmask.fem6.hdf")

pix_matrix <- detectorchecker::load_pix_matrix(layout = layout, file_path = dead_path)

# Retreiving dead pixels
pix_dead <- detectorchecker::dead_pix_coords(pix_matrix)

# Plotting
detectorchecker::plot_layout_damaged(layout = layout, pix_dead = pix_dead,
                      file_path = "layout_damaged.jpeg")
                      
```

![Excalibur damaged](Excalibur_damaged.jpeg)

## Model fitting

```
# Choosing layout
layout <- create_module("Pilatus")

# getting the dead (damaged) pixel data
dead_path <- file.path(test_dir, "dead_pix", "Pilatus", "badpixel_mask.tif")

pix_matrix <- load_pix_matrix(layout = layout, file_path = dead_path)



```
